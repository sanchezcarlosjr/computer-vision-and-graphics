---
layout: default
title:  "Exercise 1 - A perfect square"
---
<style>
container {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
}

canvas {
	aspect-ratio: 1 / 1;
	width: 50%;
	max-height: 50%;
	border: none;
	padding: 0;
	margin: 0;
}
</style>

<container>
  <canvas id="gl-canvas">Your browser does not seem to support HTML canvas.</canvas>
</container>

<script src="https://unpkg.com/rxjs@^7/dist/bundles/rxjs.umd.min.js"></script>
<script src="https://interactivecomputergraphics.com/Code/Common/initShaders.js"></script>
<script src="https://interactivecomputergraphics.com/Code/Common/MVnew.js"</script>

/* Ignore this because something is remove it. */
<script id="fragment-shader2" type="x-shader/x-fragment"></script>

<script id="fragment-shader" type="x-shader/x-fragment">
 #version 300 es
 precision mediump float;
 out vec4 fColor;
 void main() {
     fColor = vec4(0.949,0.804,0.361,1.0);
 }
</script>

<script id="vertex-shader" type="x-shader/x-vertex">
 #version 300 es
 in vec4 aPosition;
 void main() {
    gl_Position = aPosition;
 }
</script>

<script>
	const { of, filter, map } = rxjs;
	function error(message) {
		// I know this is dump, but for JavaScript "throw" is not a expression.
		throw new Error(message);
	}
	const clousure = (op) => (ob) => {
		if (ob) op(ob);
		return ob;
	};
	of(document.getElementById('gl-canvas'))
		.pipe(
			//  Configure WebGL
			filter(canvas => !!canvas),
			map(canvas => clousure(gl => {
					gl.viewport(0, 0, canvas.width, canvas.height);
					gl.clearColor(0.251,0.055,0.196,1.0);
				})(canvas.getContext('webgl2')) ?? error("WebGL 2.0 isn't available.")
			),
			//  Load shaders and initialize attribute buffers
			map(gl => {
				const program = initShaders(gl, "vertex-shader", "fragment-shader");
				gl.useProgram(program);
				return {gl,program};
			}),
			 // Load vertices into the GPU
			map(({gl,program}) => {
				const square = [
					vec2( -0.5, -0.5 ),
					vec2( -0.5,  0.5 ),
					vec2(  0.5,  0.5 ),
					vec2(  0.5, -0.5 )
				];
				const bufferId = gl.createBuffer();
				gl.bindBuffer(gl.ARRAY_BUFFER,bufferId);
				gl.bufferData(gl.ARRAY_BUFFER,flatten(square),gl.STATIC_DRAW);
				return {gl,program,square};
			}),
			// Associate our shader variable with our data buffer
			map(({gl, program, square}) => {
				const aPosition = gl.getAttribLocation( program, "aPosition" );
				gl.vertexAttribPointer( aPosition, 2, gl.FLOAT, false, 0, 0 );
				gl.enableVertexAttribArray(aPosition);
				return {gl, square};
			})
		)
		.subscribe(({gl,square}) => {
			gl.clear( gl.COLOR_BUFFER_BIT );
			gl.drawArrays( gl.TRIANGLE_FAN, 0, square.length);
		});
</script>
